# üß† Esp2Rus_bot ‚Äî –¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ: –ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è –æ–±—É—á–µ–Ω–∏—è (v2)

## üéØ –¶–µ–ª—å
–ü–æ—Å—Ç—Ä–æ–∏—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –º–∞—Ä—à—Ä—É—Ç –æ–±—É—á–µ–Ω–∏—è –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –≤ –∫–æ—Ç–æ—Ä–æ–º:
- –°–ª–æ–≤–∞ —Å—á–∏—Ç–∞—é—Ç—Å—è –≤—ã—É—á–µ–Ω–Ω—ã–º–∏ –ø—Ä–∏ –º–Ω–æ–≥–æ–∫—Ä–∞—Ç–Ω–æ–º –ø–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω–Ω–æ–º –∑–Ω–∞–Ω–∏–∏
- –ü—Ä–æ–≥—Ä–µ—Å—Å –ø–æ —Ç–µ–º–∞–º –∏ —É—Ä–æ–≤–Ω—è–º –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç—Å—è –∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- –£—Ä–æ–≤–µ–Ω—å –≤–ª–∞–¥–µ–Ω–∏—è –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –ø–æ –æ—Ö–≤–∞—Ç—É –∏ —Ç–æ—á–Ω–æ—Å—Ç–∏
- –ü–æ–≤—Ç–æ—Ä–µ–Ω–∏—è —Ä–µ–≥—É–ª–∏—Ä—É—é—Ç—Å—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –∏—Å—Ç–æ—Ä–∏–∏ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏–∏

```
analytics/
‚îú‚îÄ‚îÄ save_client_activity_log.py       # –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç stats, learned_words
‚îú‚îÄ‚îÄ save_client_analytics.py          # –æ–±–Ω–æ–≤–ª—è–µ—Ç —Ä–µ–π—Ç–∏–Ω–≥, –ø—Ä–æ–≥—Ä–µ—Å—Å, —É—Ä–æ–≤–µ–Ω—å
‚îú‚îÄ‚îÄ calculate_client_id_current.py    # –ª–æ–≥–∏–∫–∞ –ø—Ä–∏—Å–≤–æ–µ–Ω–∏—è —É—Ä–æ–≤–Ω—è –ø–æ –º–∞—Ç—Ä–∏—Ü–µ
‚îú‚îÄ‚îÄ metrics/
‚îÇ   ‚îú‚îÄ‚îÄ get_level_id_word.py
‚îÇ   ‚îú‚îÄ‚îÄ calculate_quiz_weight.py
‚îÇ   ‚îî‚îÄ‚îÄ ...
db/
‚îú‚îÄ‚îÄ create/
‚îÇ   ‚îú‚îÄ‚îÄ learned_words.sql
‚îÇ   ‚îú‚îÄ‚îÄ user_word_stats.sql
‚îÇ   ‚îú‚îÄ‚îÄ user_progress_by_theme.sql
‚îÇ   ‚îú‚îÄ‚îÄ level_matrix.sql
‚îÇ   ‚îî‚îÄ‚îÄ ...
```

---

## üì¶ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö: —Ç–∞–±–ª–∏—Ü—ã

### 1. learned_words

–•—Ä–∞–Ω–∏—Ç —Ñ–∞–∫—Ç –≤—ã—É—á–∏–≤–∞–Ω–∏—è —Å–ª–æ–≤–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —É—Å–ø–µ—à–Ω—ã—Ö –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π.

| –ü–æ–ª–µ         | –¢–∏–ø     | –û–ø–∏—Å–∞–Ω–∏–µ                              |
|--------------|---------|---------------------------------------|
| client_id    | int     | ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–∏–∑ `client_info`)    |
| word_id      | int     | ID —Å–ª–æ–≤–∞ (–∏–∑ `dictionary`)                     |
| learned_at   | date    | –î–∞—Ç–∞ –≤—ã—É—á–∏–≤–∞–Ω–∏—è                       |
| activity_id  | int     | –°—Å—ã–ª–∫–∞ –Ω–∞ –≤–∏–∫—Ç–æ—Ä–∏–Ω—É (client_activity) |

üîÅ –°–ª–æ–≤–æ —Å—á–∏—Ç–∞–µ—Ç—Å—è –≤—ã—É—á–µ–Ω–Ω—ã–º –ø–æ—Å–ª–µ `N` –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤  
`N` –∑–∞–¥–∞—ë—Ç—Å—è –≤ `LEARN_THRESHOLD = 3` (–≤ `settings.py` –∏–ª–∏ `config.py`)

---

### 2. user_word_stats

–•—Ä–∞–Ω–∏—Ç –¥–µ—Ç–∞–ª—å–Ω—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ –∫–∞–∂–¥–æ–º—É —Å–ª–æ–≤—É.

| –ü–æ–ª–µ         | –¢–∏–ø     | –û–ø–∏—Å–∞–Ω–∏–µ                           |
|--------------|---------|------------------------------------|
| client_id    | int     | ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–∏–∑ `client_info`) |
| word_id      | int     | ID —Å–ª–æ–≤–∞ (–∏–∑ `dictionary`)                          |
| total_seen   | int     | –°–∫–æ–ª—å–∫–æ —Ä–∞–∑ —Å–ª–æ–≤–æ –ø–æ–∫–∞–∑—ã–≤–∞–ª–æ—Å—å     |
| correct      | int     | –ö–æ–ª-–≤–æ –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤          |
| incorrect    | int     | –ö–æ–ª-–≤–æ –æ—à–∏–±–æ–∫                      |
| last_seen    | date    | –ü–æ—Å–ª–µ–¥–Ω—è—è –ø–æ–ø—ã—Ç–∫–∞                  |

---

### 3. user_progress_by_theme

–û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ —Ç–µ–º–µ –Ω–∞ —Ç–µ–∫—É—â–µ–º —É—Ä–æ–≤–Ω–µ.

| –ü–æ–ª–µ         | –¢–∏–ø     | –û–ø–∏—Å–∞–Ω–∏–µ                              |
|--------------|---------|----------------------------------------|
| client_id    | int     | ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–∏–∑ `client_info`)                       |
| cat_id       | int     | ID —Ç–µ–º—ã (–∏–∑ `word_category`)           |
| level_id     | int     | –£—Ä–æ–≤–µ–Ω—å (–∏–∑ `study_level`)             |
| total_words  | int     | –ö–æ–ª-–≤–æ —Å–ª–æ–≤ –ø–æ —Ç–µ–º–µ –∏ —É—Ä–æ–≤–Ω—é           |
| learned_words| int     | –°–∫–æ–ª—å–∫–æ –≤—ã—É—á–µ–Ω–æ                        |
| percent_done | float   | % –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Ç–µ–º—ã                      |
| updated_at   | date    | –ü–æ—Å–ª–µ–¥–Ω–∏–π –ø–µ—Ä–µ—Å—á—ë—Ç                     |

üß† –ü—Ä–∏ –ø–æ–≤—ã—à–µ–Ω–∏–∏ `level_id_current`:
- –∑–∞–ø–∏—Å–∏ –ø–æ —Å—Ç–∞—Ä–æ–º—É —É—Ä–æ–≤–Ω—é —É–¥–∞–ª—è—é—Ç—Å—è
- —Å–æ–∑–¥–∞—é—Ç—Å—è –∑–∞–ø–∏—Å–∏ –ø–æ –Ω–æ–≤–æ–º—É

---

### 4. level_matrix

–•—Ä–∞–Ω–∏—Ç CEFR-–ª–æ–≥–∏–∫—É –ø–µ—Ä–µ—Ö–æ–¥–∞ –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π —É—Ä–æ–≤–µ–Ω—å.

| –ü–æ–ª–µ              | –¢–∏–ø    | –û–ø–∏—Å–∞–Ω–∏–µ                          |
|-------------------|--------|-----------------------------------|
| level_id_client   | int    | –¶–µ–ª–µ–≤–æ–π —É—Ä–æ–≤–µ–Ω—å (1‚Äì6)             |
| required_coverage | int    | % –æ—Ö–≤–∞—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, 50 –∏–ª–∏ 100)   |
| required_accuracy | int    | % —Ç–æ—á–Ω–æ—Å—Ç–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, 100)        |

üß© `required_accuracy` –∑–∞–¥–∞—ë—Ç—Å—è –≥–ª–æ–±–∞–ª—å–Ω–æ: `LEVEL_ACCURACY_THRESHOLD = 100`

---

## üõ† –ö–ª—é—á–µ–≤—ã–µ –º–æ–¥—É–ª–∏

| –ú–æ–¥—É–ª—å                     | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ                                       |
|----------------------------|--------------------------------------------------|
| save_client_activity_log   | –ª–æ–≥–∏—Ä—É–µ—Ç –æ—Ç–≤–µ—Ç—ã, –æ–±–Ω–æ–≤–ª—è–µ—Ç `learned_words`, `stats` |
| save_client_analytics      | –æ–±–Ω–æ–≤–ª—è–µ—Ç `rating`, `progress`, `level_id_current` |
| calculate_client_id_current| –ª–æ–≥–∏–∫–∞ –ø–µ—Ä–µ—Ö–æ–¥–∞ —É—Ä–æ–≤–Ω—è –∏–∑ `level_matrix`        |
| view_user_theme_progress   | –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø—Ä–æ–≥—Ä–µ—Å—Å –ø–æ —Ç–µ–º–∞–º                |
| view_personalized_words    | –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≤—ã–¥–∞—á–∞ —Å–ª–æ–≤                 |

---

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞

### config.py ‚Äî –°–∏—Å—Ç–µ–º–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:
- ENV_MODE, DEBUG, —Ç–æ–∫–µ–Ω—ã, —Ñ–ª–∞–≥–∏

### settings.py (config.py) ‚Äî –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:
- `LEARN_THRESHOLD = 3`
- `LEVEL_ACCURACY_THRESHOLD = 100`
- `LANGUAGE_TARGET = 'es'`

---

## üìå –û–±—â–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

- üîÅ –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–µ–∫—É—â—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É: `client_info`, `client_activity_log`, `dictionary`
- üß© –í—Å–µ —Ä–∞—Å—á—ë—Ç—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –ø—Ä–æ–∑—Ä–∞—á–Ω—ã –∏ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º—ã
- üìä –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –º—É–ª—å—Ç–∏—è–∑—ã—á–Ω–æ—Å—Ç–∏ –∑–∞–∫–ª–∞–¥—ã–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ `LANGUAGE_TARGET`