
# ‚úÖ –ü–ª–∞–Ω‚Äì–§–∞–∫—Ç –ø–æ –∞–Ω–∞–ª–∏—Ç–∏–∫–µ Esp2Rus_bot (v2)

---

## üî∑ –≠—Ç–∞–ø 1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö ‚Äî ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ

### üìå –°–¥–µ–ª–∞–Ω–æ:
- [x] –°–æ–∑–¥–∞–Ω—ã —Ç–∞–±–ª–∏—Ü—ã: `client_info`, `client_activity_log`, `client_analytics`, `study_levels`, `client_activity_words`
- [x] –ó–∞–≥—Ä—É–∂–µ–Ω —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫ —É—Ä–æ–≤–Ω–µ–π CEFR (`study_levels`)
- [x] –î–æ–±–∞–≤–ª–µ–Ω—ã –∫–ª—é—á–µ–≤—ã–µ –ø–æ–ª—è: `quiz_weight`, `level_id_word`, `lev_id` –≤ —Å–ª–æ–≤–∞—Ä—å
- [x] –ù–∞—Å—Ç—Ä–æ–µ–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–∞–ø–æ–∫: `data/`, `backup/sql/`, `logs/`
- [x] –ù–∞—Å—Ç—Ä–æ–µ–Ω `run_install.py` (–±–∞–∑–æ–≤–∞—è –≤–µ—Ä—Å–∏—è)

---

## üî∑ –≠—Ç–∞–ø 2. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –≤ Telegram-–±–æ—Ç ‚Äî ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ

### üìå –°–¥–µ–ª–∞–Ω–æ:
- [x] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –ª–æ–≥–∏–∫–∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ (`analytics_async`)
- [x] –ó–∞–ø–∏—Å—å —Å–µ—Å—Å–∏–π –≤ `client_activity_log`
- [x] –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (`client_info`)
- [x] –†–∞—Å—á—ë—Ç `quiz_weight` (–µ—Å–ª–∏ score_quiz == 1.0, –∏–Ω–∞—á–µ NULL)
- [x] –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á—ë—Ç –ø—Ä–∏ –≤—ã–±–æ—Ä–µ "–≤—Å–µ —É—Ä–æ–≤–Ω–∏"
- [x] –£—á–µ—Ç —è–∑—ã–∫–∞ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ (`language_code`)
- [x] –í—ã–Ω–µ—Å–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏ –≤ `analytics/metrics/`
- [x] –õ–æ–≥–∏–∫–∞ `client_activity_words` ‚Äî –∑–∞–ø–∏—Å—å —Å–ª–æ–≤ –≤ –≤–∏–∫—Ç–æ—Ä–∏–Ω–µ
- [x] –ü–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ PostgreSQL —á–µ—Ä–µ–∑ `asyncpg`
- [x] –ó–∞—â–∏—Ç–∞ –æ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è (ON CONFLICT)
- [x] –¢–µ—Å—Ç—ã + –±–æ–µ–≤–æ–π —Ä–µ–∂–∏–º

---

## üî∑ –≠—Ç–∞–ø 3. –†–∞—Å—á—ë—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–Ω—ã—Ö –º–µ—Ç—Ä–∏–∫ ‚Äî ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ

### üìå –°–¥–µ–ª–∞–Ω–æ:
- [x] `client_rating = SUM(quiz_weight)`
- [x] –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω –º–æ–¥—É–ª—å `calculate_client_rating.py`
- [x] –û–±–Ω–æ–≤–ª—ë–Ω `save_client_analytics.py` ‚Äî —Ä–∞—Å—á—ë—Ç –æ–Ω–ª–∞–π–Ω
- [x] –ó–∞—â–∏—Ç–∞: `quiz_weight = NULL`, –µ—Å–ª–∏ score < 100%
- [x] –ü–æ–ª–µ `client_rating` –¥–æ–±–∞–≤–ª–µ–Ω–æ –≤ `client_analytics`
- [x] –¢–∏–ø –ø–æ–ª—è —É–≤–µ–ª–∏—á–µ–Ω (–∑–∞—â–∏—Ç–∞ –æ—Ç overflow)

---

## üî∑ –≠—Ç–∞–ø 4. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –æ—Ç–∫–∞—Ç ‚Äî ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ

### üìå –°–¥–µ–ª–∞–Ω–æ:
- [x] –°–æ–∑–¥–∞–Ω–∞ —Ç–∞–±–ª–∏—Ü–∞ `cron_events`
- [x] –í—Å—Ç—Ä–æ–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á cron (`log_cron_event`)
- [x] –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω `rollback_analytics.py`
- [x] –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ñ–ª–∞–≥–∞ `USE_ANALYTICS_V2`
- [x] –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ `analytics.py` –∏–∑ –∞—Ä—Ö–∏–≤–∞

---

## üî∑ –≠—Ç–∞–ø 5. /admin_clients –∏ /report ‚Äî üîÑ –í –ø—Ä–æ—Ü–µ—Å—Å–µ

### üõ† –í —Ä–∞–±–æ—Ç–µ:
- [ ] –ü–∞–Ω–µ–ª—å `/admin_clients` ‚Äî –ø—Ä–æ–≥—Ä–µ—Å—Å, —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
- [ ] –ö–æ–º–∞–Ω–¥–∞ `/report @username` ‚Äî –æ—Ç—á—ë—Ç –ø–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
- [ ] –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤—ã–≥—Ä—É–∑–∫–∏ –æ—Ç—á—ë—Ç–æ–≤ –≤ `reports/`

---

## üî∑ –≠—Ç–∞–ø 6. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—Ç—á—ë—Ç–Ω–æ—Å—Ç—å ‚Äî üîÑ –ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–æ

### üìå –ü–ª–∞–Ω:
- [ ] –ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–π –æ—Ç—á—ë—Ç (CSV + Telegram)
- [ ] –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –ø—Ä–µ–¥—ã–¥—É—â–∏–º–∏ –Ω–µ–¥–µ–ª—è–º–∏
- [ ] –†–∞—Å—Å—ã–ª–∫–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º

---

## üî∑ –≠—Ç–∞–ø 7. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è ‚Äî üîÑ –í –ø—Ä–æ—Ü–µ—Å—Å–µ

### üìå –Æ–Ω–∏—Ç-—Ç–µ—Å—Ç—ã:
- [x] quiz_weight –ø—Ä–∏ 100% –∏ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö —Å–ª–æ–≤–∞—Ö
- [x] quiz_weight = NULL –ø—Ä–∏ <100%
- [x] –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –≤–µ—Å–æ–≤ (1.0, 1.3, 1.6)
- [x] client_rating = —Å—É–º–º–∞ quiz_weight
- [x] –ü—Ä–æ–≤–µ—Ä–∫–∞ `level_id_word`

---

## üî∑ –≠—Ç–∞–ø 8‚Äì9. –†–∞–∑–≤–∏—Ç–∏–µ + –ú–∏–≥—Ä–∞—Ü–∏—è –Ω–∞ –ø—Ä–æ–¥ ‚Äî üîÑ –ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–æ

### üìå –ü–ª–∞–Ω:
- [x] –ù–æ–≤–∞—è —Ñ–æ—Ä–º—É–ª–∞ quiz_weight (–≤–µ—Å —Ç–æ–ª—å–∫–æ –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö —Å–ª–æ–≤)
- [ ] –ü–æ–ª–Ω–æ—Ü–µ–Ω–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è `level_id_current`
- [ ] –ü–æ–¥–¥–µ—Ä–∂–∫–∞ `learned_words` ‚Äî –∏—Å–∫–ª—é—á–µ–Ω–∏–µ –≤—ã—É—á–µ–Ω–Ω–æ–≥–æ (–ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è)
- [ ] –§–∏–Ω–∞–ª–∏–∑–∞—Ü–∏—è `run_install.py`
- [ ] –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ `README_Prod_Migration.md`, `CONTRIBUTING.md`

---

## üî∑ –≠—Ç–∞–ø 10. –î–µ–∫–æ–º–ø–æ–∑–∏—Ü–∏—è –Ω–∞ –º–æ–¥—É–ª–∏ ‚Äî üîÑ –í –ø—Ä–æ—Ü–µ—Å—Å–µ

| –ü–æ–¥—ç—Ç–∞–ø                     | –°—Ç–∞—Ç—É—Å  |
|-----------------------------|---------|
| 10.1. –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–∏–∫—Ç–æ—Ä–∏–Ω—ã   | ‚úÖ |
| 10.2. –¢–∞–±–ª–∏—Ü—ã –∏ VIEW        | ‚úÖ |
| 10.3. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ | ‚úÖ |
| 10.4. –ê–¥–º–∏–Ω-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å       | ‚úÖ |

---

## üìä –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫–ª—é—á–µ–≤—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç             | –°—Ç–∞—Ç—É—Å     |
|------------------------|------------|
| `quiz_weight`          | ‚úÖ |
| `client_rating`        | ‚úÖ |
| `level_id_word`        | ‚úÖ |
| `level_id_current`     | üîÑ —á–∞—Å—Ç–∏—á–Ω–æ |
| `rollback_analytics`   | ‚úÖ |
| `cron_events`          | ‚úÖ |
| `/admin_clients`       | üîÑ |
| `/report`              | üîÑ |
| `learned_words`        | üî≤ |

---

