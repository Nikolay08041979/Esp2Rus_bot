## ‚öôÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ Esp2Ru\_bot (v2.0)

### 1. üìä –û–±—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**

* `bot/` ‚Äî Telegram-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å, FSM, –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–æ–º–∞–Ω–¥
* `analytics/` ‚Äî —Ä–∞—Å—á—ë—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å–∞, —É—Ä–æ–≤–Ω–µ–π, —Ä–µ–π—Ç–∏–Ω–≥–∞
* `db/` ‚Äî —Å—Ö–µ–º—ã —Ç–∞–±–ª–∏—Ü, VIEW, –º–∏–≥—Ä–∞—Ü–∏–∏
* `docs/` ‚Äî –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
* `tests/` ‚Äî –∞–≤—Ç–æ—Ç–µ—Å—Ç—ã –∏ —Å–∏–º—É–ª—è—Ü–∏–∏

üìå *–°–º. —Å—Ö–µ–º—É [schema_release_v2.1.0](/docs/images/schema_release_v2.png)*

---

### 2. üßô‚Äç‚ôÇÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

| –û–±—ä–µ–∫—Ç                   | –¢–∏–ø     | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ                                                 |
| ------------------------ | ------- | ---------------------------------------------------------- |
| `client_info`            | —Ç–∞–±–ª–∏—Ü–∞ | –£—á–µ—Ç –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π                                    |
| `client_activity_log`    | —Ç–∞–±–ª–∏—Ü–∞ | –õ–æ–≥ —Å–µ—Å—Å–∏–π –≤–∏–∫—Ç–æ—Ä–∏–Ω—ã                                       |
| `client_activity_words`  | —Ç–∞–±–ª–∏—Ü–∞ | –ü—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –ø–æ –∫–∞–∂–¥–æ–º—É —Å–ª–æ–≤—É                              |
| `learned_words`          | —Ç–∞–±–ª–∏—Ü–∞ | –°–ª–æ–≤–∞, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã—É—á–∏–ª (‚â• 3 –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã—Ö –æ—Ç–≤–µ—Ç–∞) |
| `client_analytics`       | —Ç–∞–±–ª–∏—Ü–∞ | –†–∞—Å—á—ë—Ç —Ä–µ–π—Ç–∏–Ω–≥–∞, —É—Ä–æ–≤–Ω—è –≤–ª–∞–¥–µ–Ω–∏—è                           |
| `cron_events`            | —Ç–∞–±–ª–∏—Ü–∞ | –õ–æ–≥ —Ñ–æ–Ω–æ–≤—ã—Ö –∑–∞–¥–∞—á                                          |
| `dictionary`             | —Ç–∞–±–ª–∏—Ü–∞ | –û—Å–Ω–æ–≤–Ω–æ–π —Å–ª–æ–≤–∞—Ä—å: —Å–ª–æ–≤–æ, –ø–µ—Ä–µ–≤–æ–¥, –∫–∞—Ç–µ–≥–æ—Ä–∏—è, —É—Ä–æ–≤–µ–Ω—å       |
| `word_category`          | —Ç–∞–±–ª–∏—Ü–∞ | –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ —Å–ª–æ–≤ (—Ç–µ–º—ã)                                      |
| `study_level`            | —Ç–∞–±–ª–∏—Ü–∞ | –£—Ä–æ–≤–Ω–∏ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ (–Ω–∞—á–∞–ª—å–Ω—ã–π, —Å—Ä–µ–¥–Ω–∏–π –∏ —Ç.–ø.)               |
| `user_progress_by_theme` | —Ç–∞–±–ª–∏—Ü–∞ | –ü—Ä–æ–≥—Ä–µ—Å—Å –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º –∏ —É—Ä–æ–≤–Ω—è–º                           |
| `quiz_weight`         | `client_activity_log` | –í–µ—Å –≤–∏–∫—Ç–æ—Ä–∏–Ω—ã (–µ—Å–ª–∏ score_quiz = 1.0)                        |
| `level_id_word`       | `client_activity_log` | –£—Ä–æ–≤–µ–Ω—å —Å–ª–æ–≤ (–µ—Å–ª–∏ –≤—ã–±—Ä–∞–Ω –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π), –∏–Ω–∞—á–µ NULL           |


**VIEWs (–ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è):**

* `level_matrix` ‚Äî –ª–æ–≥–∏–∫–∞ CEFR-—É—Ä–æ–≤–Ω–µ–π –∏ –ø–æ—Ä–æ–≥–æ–≤
* `client_level_progress` ‚Äî –æ—Ö–≤–∞—Ç —Å–ª–æ–≤ –ø–æ —É—Ä–æ–≤–Ω—è–º (coverage)
* `view_user_progress_by_theme` ‚Äî —á–∏—Ç–∞–µ–º–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –ø–æ —Ç–µ–º–∞–º/—É—Ä–æ–≤–Ω—è–º

---

### 3. üõ†Ô∏è –ú–æ–¥—É–ª—å `run_install.py`

–ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ:

* –£–¥–∞–ª—è–µ—Ç –∏ –ø–µ—Ä–µ—Å–æ–∑–¥–∞–µ—Ç —Ç–∞–±–ª–∏—Ü—ã –∏ VIEW
* –ó–∞–≥—Ä—É–∂–∞–µ—Ç –¥–µ—Ñ–æ–ª—Ç–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è (–∫–∞—Ç–µ–≥–æ—Ä–∏–∏, —É—Ä–æ–≤–Ω–∏)
* –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ, –µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω–æ

---

### 4. üîÑ –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ –º–æ–¥—É–ª–µ–π

**–°—Ü–µ–Ω–∞—Ä–∏–π 1**: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–æ—Ö–æ–¥–∏—Ç –≤–∏–∫—Ç–æ—Ä–∏–Ω—É

* `client_activity_log` ‚Üê —Å–æ–∑–¥–∞—ë—Ç—Å—è –∑–∞–ø–∏—Å—å
* `client_activity_words` ‚Üê –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ –∫–∞–∂–¥–æ–º—É —Å–ª–æ–≤—É
* `learned_words` ‚Üê –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è —Å–ª–æ–≤–æ (–µ—Å–ª–∏ ‚â• 3 –≤–µ—Ä–Ω—ã—Ö)
* `client_analytics` ‚Üê –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è —Ä–µ–π—Ç–∏–Ω–≥ –∏ —É—Ä–æ–≤–µ–Ω—å
* `user_progress_by_theme` ‚Üê –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
* `cron_events` ‚Üê –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ

**–°—Ü–µ–Ω–∞—Ä–∏–π 2**: –∞–¥–º–∏–Ω –≤—ã–∑—ã–≤–∞–µ—Ç `/admin/report`

* `client_analytics` –∏ `user_progress_by_theme` ‚Üí –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–µ–∫—Å—Ç–∞ –æ—Ç—á–µ—Ç–∞
* `level_matrix` ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è —É—Ä–æ–≤–Ω–µ–π

---

### 5. ‚è±Ô∏è Cron-–∑–∞–¥–∞—á–∏

* `sync_client_analytics.py` ‚Äî offline-–ø–µ—Ä–µ—Ä–∞—Å—á—ë—Ç (esli LEVEL\_CALCULATION\_ONLINE = False)
* `generate_admin_day_report.py` ‚Äî –µ–∂–µ–¥–Ω–µ–≤–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞
* –í—Å–µ –¥–µ–π—Å—Ç–≤–∏—è –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –≤ `cron_events`

---

### üîç –î–µ—Ç–∞–ª–∏ —Ä–∞—Å—á–µ—Ç–∞ quiz_weight

### 6. ‚öñÔ∏è –†–∞—Å—á—ë—Ç —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –≤–∏–∫—Ç–æ—Ä–∏–Ω—ã (quiz_weight)

* `quiz_weight` —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è **—Ç–æ–ª—å–∫–æ –ø—Ä–∏ 100% —Ç–æ—á–Ω–æ—Å—Ç–∏ (score_quiz = 1.0)**
* –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–≤–∞ –º–µ—Ç–æ–¥–∞:
  1. **–í—ã–±–æ—Ä —É—Ä–æ–≤–Ω—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º**:
     * `level_id_word` ‚Üí `lev_id` —á–µ—Ä–µ–∑ `view_study_level_mapped`
     * `lev_id` ‚Üí `weight_value` –∏–∑ `view_quiz_weight_by_group`
  2. **–°–º–µ—à–∞–Ω–Ω—ã–µ —É—Ä–æ–≤–Ω–∏ (–≤—Å–µ —É—Ä–æ–≤–Ω–∏)**:
     * `word_src` ‚Üí –≤–µ—Å–∞ –∏–∑ `view_word_weight`
     * —É—Å—Ä–µ–¥–Ω—ë–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ –≤—Å–µ–º —Å–ª–æ–≤–∞–º –≤–∏–∫—Ç–æ—Ä–∏–Ω—ã
* ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω **–∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç WORD_CORRECT_VALUE (0.1)**:
  > `quiz_weight = –±–∞–∑–æ–≤—ã–π_–≤–µ—Å √ó WORD_CORRECT_VALUE √ó –∫–æ–ª-–≤–æ_–ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö_—Å–ª–æ–≤`
