## üêõ Troubleshooting Esp2Ru Bot v2.0

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Å–∏–º–ø—Ç–æ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

#### 1. –ë–æ—Ç –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è (`main.py`)

* **–û—à–∏–±–∫–∞:** "BOT\_TOKEN is not set"
  **–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä—å `.env` —Ñ–∞–π–ª. –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è `BOT_TOKEN` –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å ENV\_MODE (`BOT_TOKEN_DEV` –∏–ª–∏ `BOT_TOKEN_PROD`).

* **–û—à–∏–±–∫–∞:** "aiogram.exceptions.TelegramBadRequest"
  **–†–µ—à–µ–Ω–∏–µ:** –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—ã –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ –Ω–µ–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, tuple –≤ `answer_document`, –≤–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `InputFile`).

---

#### 2. –ù–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∑–∞–≥—Ä—É–∑–∫–∞ —Å–ª–æ–≤–∞—Ä—è —á–µ—Ä–µ–∑ CSV

* **–û—à–∏–±–∫–∞:** "Invalid CSV format"
  **–†–µ—à–µ–Ω–∏–µ:** –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∑–∞–≥—Ä—É–∂–∞–µ–º—ã–π CSV-—Ñ–∞–π–ª —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —à–∞–±–ª–æ–Ω—É. –°–º. —Ä–∞–∑–¥–µ–ª `admin_manual.md` ‚Üí –ó–∞–≥—Ä—É–∑–∫–∞ —Å–ª–æ–≤–∞—Ä—è.

* **–û—à–∏–±–∫–∞:** "duplicate key value violates unique constraint idx\_unique\_word\_src\_lower"
  **–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –Ω–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –ª–∏ —Å–ª–æ–≤–æ –ø–æ–≤—Ç–æ—Ä–Ω–æ. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `ON CONFLICT DO NOTHING` –ø—Ä–∏ –º–∞—Å—Å–æ–≤–æ–π –∑–∞–≥—Ä—É–∑–∫–µ.

---

#### 3. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –ø–æ–ª—É—á–∞–µ—Ç –æ—Ç—á—ë—Ç `/report`

* **–°–∏–º–ø—Ç–æ–º:** "NoneType object is not subscriptable"
  **–†–µ—à–µ–Ω–∏–µ:** –≠—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç, –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω –∏–ª–∏ –Ω–µ –ø—Ä–æ—à—ë–ª –Ω–∏ –æ–¥–Ω–æ–π –≤–∏–∫—Ç–æ—Ä–∏–Ω—ã. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–∞–±–ª–∏—Ü—É `client_info` –∏ `client_activity_log`.

---

#### 4. –ù–µ —Ñ–æ—Ä–º–∏—Ä—É—é—Ç—Å—è –º–µ—Ç—Ä–∏–∫–∏ –∏ —É—Ä–æ–≤–µ–Ω—å

* **–°–∏–º–ø—Ç–æ–º:** `client_rating` –≤—Å–µ–≥–¥–∞ —Ä–∞–≤–µ–Ω 0, `level_id_current` = NULL
  **–†–µ—à–µ–Ω–∏–µ:** –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–æ—Å–ª–µ –≤–∏–∫—Ç–æ—Ä–∏–Ω—ã –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è `log_client_activity()`, –∞ –≤–Ω—É—Ç—Ä–∏ –Ω–µ–≥–æ ‚Äî `save_client_analytics()` –∏ `refresh_user_progress()`.

* **–°–∏–º–ø—Ç–æ–º:** `client_analytics` –ø—É—Å—Ç–∞—è
  **–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–ª–∞–≥ `USE_ANALYTICS_V2` –≤ `analytics.py`. –î–æ–ª–∂–µ–Ω –±—ã—Ç—å `True`.

---

#### 5. –ù–µ –∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è `user_progress_by_theme`

* **–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –ª–∏ `refresh_user_progress()` –≤ `analytics.py`.
* –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `learned_words` —Å–æ–¥–µ—Ä–∂–∏—Ç –∑–∞–ø–∏—Å–∏ (–æ—Å–Ω–æ–≤–Ω–æ–π –∏—Å—Ç–æ—á–Ω–∏–∫).

---

#### 6. –ù–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ–º–∞–Ω–¥–∞ `/admin/report/log` –∏–ª–∏ –æ—à–∏–±–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∞ CSV

* **–°–∏–º–ø—Ç–æ–º:** "Unsupported start tag \_io.bytesio..."
  **–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `InputFile(io.BytesIO(...))`, –∞ –Ω–µ tuple.

---

#### 7. –í—Å–µ —Å–ª–æ–≤–∞ –∏–∑—É—á–µ–Ω—ã, –Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ

* **–ü—Ä–æ–±–ª–µ–º–∞:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç "‚ùå –ù–µ—Ç —Å–ª–æ–≤", —Ö–æ—Ç—è –æ–Ω –≤—Å—ë –≤—ã—É—á–∏–ª

  **–†–µ—à–µ–Ω–∏–µ:** –í `word_count_selected` –∏ `start_quiz` –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –Ω–∞–ª–∏—á–∏–µ —Å–ª–æ–≤. –ü—Ä–∏ –Ω—É–ª–µ ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ: "–í—ã –∏–∑—É—á–∏–ª–∏ –≤—Å–µ —Å–ª–æ–≤–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏/—É—Ä–æ–≤–Ω—è..."

---

### üìå –ü—Ä–æ—á–µ–µ

* **–ö–∞–∫ —É–∑–Ω–∞—Ç—å —Å–≤–æ–π `tg_id`:** –ù–∞–ø–∏—Å–∞—Ç—å `/start` –±–æ—Ç—É –∏ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤ –æ—Ç—á—ë—Ç–µ `/report`
* **–ö–∞–∫ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ–≥–æ –∞–¥–º–∏–Ω–∞:** –î–æ–±–∞–≤–∏—Ç—å –µ–≥–æ `tg_id` –≤ —Å–ø–∏—Å–æ–∫ `ADMIN_IDS` –≤ `config.py`
* **–ö–∞–∫ –ø–µ—Ä–µ–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ —Ç–∞–±–ª–∏—Ü—ã:** –∑–∞–ø—É—Å—Ç–∏—Ç—å `run_install.py`, –Ω–æ **–ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ —Å–¥–µ–ª–∞—Ç—å —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é –¥–∞–Ω–Ω—ã—Ö**

---

### üîÅ –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

* `/cancel` ‚Äî –ø—Ä–µ—Ä–≤–∞—Ç—å —Ç–µ–∫—É—â—É—é —Å–µ—Å—Å–∏—é
* `/admin` ‚Äî –≤—Ö–æ–¥ –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å
* `/admin/report` ‚Äî —Å–≤–æ–¥–∫–∞ –ø–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º
* `/admin/report/log/7` ‚Äî –ª–æ–≥–∏ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π –≤ CSV

---

–ï—Å–ª–∏ –æ—à–∏–±–∫–∞ –Ω–µ –æ–ø–∏—Å–∞–Ω–∞ –≤—ã—à–µ ‚Äî –ø—Ä–æ–≤–µ—Ä—å –ª–æ–≥–∏ –∏–ª–∏ –æ–±—Ä–∞—Ç–∏—Å—å –∫ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫—É. –í—Å–µ –ª–æ–≥–∏ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ —Ç–∞–±–ª–∏—Ü–µ `cron_events` –∏ –≤ `analytics_debug`.
