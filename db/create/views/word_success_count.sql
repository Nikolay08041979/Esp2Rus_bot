-- üîç VIEW: word_success_count
-- üìå –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:
-- –î–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –∫–∞–∂–¥–æ–≥–æ —Å–ª–æ–≤–∞ —Å—á–∏—Ç–∞–µ—Ç:
--   - –æ–±—â–µ–µ —á–∏—Å–ª–æ –ø–æ–ø—ã—Ç–æ–∫ (total_attempts)
--   - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤ (correct_count)
-- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è, –≤—ã—É—á–µ–Ω–æ –ª–∏ —Å–ª–æ–≤–æ (–µ—Å–ª–∏ correct_count >= 3).

-- üí° –≠—Ç–æ —è–¥—Ä–æ –ª–æ–≥–∏–∫–∏ –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏–∏: –µ—Å–ª–∏ —Å–ª–æ–≤–æ –±—ã–ª–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –ø–µ—Ä–µ–≤–µ–¥–µ–Ω–æ 3 –∏ –±–æ–ª–µ–µ —Ä–∞–∑,
-- –æ–Ω–æ –º–æ–∂–µ—Ç —Å—á–∏—Ç–∞—Ç—å—Å—è "–≤—ã—É—á–µ–Ω–Ω—ã–º" –∏ –±—ã—Ç—å –∏—Å–∫–ª—é—á–µ–Ω–æ –∏–∑ —Å–ª–µ–¥—É—é—â–∏—Ö –≤–∏–∫—Ç–æ—Ä–∏–Ω.

CREATE OR REPLACE VIEW word_success_count AS
SELECT
    cal.client_id,         -- –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    caw.word_id,           -- –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Å–ª–æ–≤–∞
    COUNT(*) FILTER (WHERE caw.is_correct = TRUE) AS correct_count,  -- —á–∏—Å–ª–æ —É—Å–ø–µ—à–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫
    COUNT(*) AS total_attempts                                      -- –æ–±—â–µ–µ —á–∏—Å–ª–æ –ø–æ–ø—ã—Ç–æ–∫
FROM client_activity_words caw
JOIN client_activity_log cal ON cal.id = caw.activity_id
GROUP BY cal.client_id, caw.word_id;
